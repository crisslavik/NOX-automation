---
- name: Try install Brave from dnf (if repository available)
  ansible.builtin.dnf:
    name: "{{ brave_package }}"
    state: present
  register: brave_dnf
  failed_when: false

- name: Ensure flatpak is installed for fallback
  ansible.builtin.dnf:
    name: flatpak
    state: present
  when: brave_dnf is defined and (brave_dnf is failed or brave_dnf is skipped)

- name: Add Flathub repository for Brave fallback
  ansible.builtin.flatpak_remote:
    name: flathub
    state: present
    flatpakrepo_url: https://flathub.org/repo/flathub.flatpakrepo
  when: brave_dnf is defined and (brave_dnf is failed or brave_dnf is skipped)

- name: Install Brave via Flatpak if dnf install not successful
  ansible.builtin.flatpak:
    name: "{{ brave_flatpak }}"
    state: present
  register: brave_flatpak_install
  when: brave_dnf is defined and (brave_dnf is failed or brave_dnf is skipped)

- name: Verify Brave installation
  ansible.builtin.command: brave-browser --version
  register: brave_version
  changed_when: false
  failed_when: false

- name: Display Brave installation result
  ansible.builtin.pause:
    seconds: 1
    prompt: |

      {% if brave_version.stdout %}
      ✅ Brave Browser installed: {{ brave_version.stdout }}
      {% else %}
      ⚠️ Brave installation not verified by binary check. Check manually.
      {% endif %}
