---
- name: Try install Brave from dnf (if repository available)
  ansible.builtin.dnf:
    name: "{{ brave_package }}"
    state: present
  register: brave_dnf
  failed_when: false

- name: Ensure flatpak is installed for fallback
  ansible.builtin.dnf:
    name: flatpak
    state: present
  when: brave_dnf is defined and (brave_dnf is failed or brave_dnf is skipped)

- name: Install Brave via Flatpak if dnf install not successful
  ansible.builtin.command:
    cmd: flatpak install -y flathub {{ brave_flatpak }}
  register: brave_flatpak
  failed_when: brave_flatpak.rc != 0
  when: brave_dnf is defined and (brave_dnf is failed or brave_dnf is skipped)

- name: Verify Brave installation
  ansible.builtin.command: brave-browser --version
  register: brave_version
  changed_when: false
  failed_when: false

- name: Display Brave installation result
  ansible.builtin.pause:
    seconds: 1
    prompt: |

      {% if brave_version.stdout %}
      ✅ Brave Browser installed: {{ brave_version.stdout }}
      {% else %}
      ⚠️ Brave installation not verified by binary check. Check manually.
      {% endif %}
