---
- name: Install Flatpak package
  ansible.builtin.dnf:
    name: flatpak
    state: present
  register: flatpak_install

- name: Display Flatpak installation status
  ansible.builtin.debug:
    msg: "Flatpak installation: {{ 'already present' if not flatpak_install.changed else 'newly installed' }}"

- name: Add Flathub repository
  ansible.builtin.flatpak_remote:
    name: flathub
    state: present
    flatpakrepo_url: https://flathub.org/repo/flathub.flatpakrepo
  register: flathub_add

- name: Display Flathub repository status
  ansible.builtin.debug:
    msg: "Flathub repository: {{ 'newly added' if flathub_add.changed else 'already configured' }}"

- name: Install Google Chrome from Flatpak
  ansible.builtin.flatpak:
    name: com.google.Chrome
    state: present
  register: chrome_install

- name: Display Chrome installation output
  ansible.builtin.debug:
    msg: "Chrome installation: {{ 'newly installed' if chrome_install.changed else 'already present' }}"

- name: Verify Chrome installation
  ansible.builtin.command:
    cmd: flatpak list --app --columns=application
  register: chrome_check
  changed_when: false
  failed_when: false

- name: Display final installation status
  ansible.builtin.debug:
    msg: "{{ '✅ Google Chrome is installed via Flatpak' if 'com.google.Chrome' in chrome_check.stdout else '❌ Google Chrome is NOT installed - check errors above' }}"
