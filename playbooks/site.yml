---
# Site playbook: Complete NOX VFX workstation deployment
# Use: ansible-playbook -i inventory playbooks/site.yml

# ========================================
# PHASE 0: System Configuration
# ========================================
- name: "PHASE 0A: SELinux Permissive Mode"
  ansible.builtin.import_playbook: selinux-permissive.yml
  tags:
    - system
    - selinux
    - phase0

- name: "PHASE 0B: Kernel Installation Limit"
  ansible.builtin.import_playbook: kernel-limit.yml
  tags:
    - system
    - kernel
    - phase0

# ========================================
# PHASE 1: NOX Full Workstation Setup
# ========================================
- name: NOX Workstation Full Deployment
  hosts: all
  become: yes
  gather_facts: yes

  roles:
    - role: domain_join
      when: "ansible_distribution == 'AlmaLinux' or ansible_os_family == 'RedHat'"

    - role: local_cache
      when: "ansible_architecture == 'x86_64'"

    - role: gnome
      when: "ansible_facts['ansible_env'].XDG_CURRENT_DESKTOP is defined or true"

    - role: brave
      when: "ansible_facts['ansible_env'].XDG_CURRENT_DESKTOP is defined or true"

    - role: slack
      when: "ansible_facts['ansible_env'].XDG_CURRENT_DESKTOP is defined or true"

    - role: blender
      when: "ansible_facts['ansible_env'].XDG_CURRENT_DESKTOP is defined or true"

    - role: davinci
      when: "ansible_facts['ansible_env'].XDG_CURRENT_DESKTOP is defined or true"

    - role: deadline-client
      when: "ansible_facts['ansible_env'].XDG_CURRENT_DESKTOP is defined or true"

    - role: neatvideo
      when: "ansible_facts['ansible_env'].XDG_CURRENT_DESKTOP is defined or true"

    - role: nuke
      when: "ansible_facts['ansible_env'].XDG_CURRENT_DESKTOP is defined or true"

    - role: rv
      when: "ansible_facts['ansible_env'].XDG_CURRENT_DESKTOP is defined or true"

    - role: pureref
      when: "ansible_facts['ansible_env'].XDG_CURRENT_DESKTOP is defined or true"

    - role: krita
      when: "ansible_facts['ansible_env'].XDG_CURRENT_DESKTOP is defined or true"

    - role: das-element
      when: "ansible_facts['ansible_env'].XDG_CURRENT_DESKTOP is defined or true"

    - role: xstudio
      when: "ansible_facts['ansible_env'].XDG_CURRENT_DESKTOP is defined or true"

    - role: dev-util
      when: "ansible_facts['ansible_env'].XDG_CURRENT_DESKTOP is defined or true"

    - role: nice-dcv
      when: "ansible_facts['ansible_distribution'] == 'AlmaLinux' or ansible_os_family == 'RedHat'"

    - role: flameshot
      when: "ansible_facts['ansible_env'].XDG_CURRENT_DESKTOP is defined or true"

    - role: vscode
      when: "ansible_facts['ansible_env'].XDG_CURRENT_DESKTOP is defined or true"

    - role: chrome
      when: "ansible_facts['ansible_env'].XDG_CURRENT_DESKTOP is defined or true"

    - role: sublime
      when: "ansible_facts['ansible_env'].XDG_CURRENT_DESKTOP is defined or true"
